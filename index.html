<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <title>WA Report Tools</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    :root{
      --success:#22c55e;
      --danger:#ef4444;
      --primary:#3b82f6;
    }
    body{
      margin:0;
      font-family:system-ui,sans-serif;
      background:#f5f5f5;
      display:flex;
      height:100vh;
      align-items:center;
      justify-content:center;
    }
    .card{
      background:#fff;
      padding:30px 40px;
      border-radius:12px;
      box-shadow:0 2px 12px rgba(0,0,0,.15);
      width:100%;
      max-width:420px;
    }
    h2{margin-top:0}
    input,select,button{
      width:100%;
      padding:10px;
      margin:8px 0;
      border:1px solid #bbb;
      border-radius:6px;
      font-size:15px;
    }
    button{background:var(--primary);color:#fff;border:none;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    #progress{
      display:flex;
      flex-wrap:wrap;
      gap:4px;
      margin-top:12px;
    }
    .dot{
      width:14px;
      height:14px;
      border-radius:50%;
      background:#e5e7eb;
    }
    .dot.ok{background:var(--success)}
    .dot.err{background:var(--danger)}
    .hidden{display:none}
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage" class="card">
  <h2>Login</h2>
  <input id="pwd" type="password" placeholder="Password">
  <button onclick="login()">Masuk</button>
</div>

<!-- REPORT TOOLS -->
<div id="reportPage" class="card hidden">
  <h2>Report Tools</h2>

  <label>Nomor WhatsApp kamu (62xx)</label>
  <input id="myPhone" type="tel" placeholder="6281234567890">

  <button onclick="getPairingCode()">Dapatkan Kode Pairing</button>
  <p id="pairInfo" class="hidden">Kode pairing: <strong id="pairCode"></strong></p>

  <label>Jumlah report</label>
  <select id="countSelect">
    <option value="50">50 (gratis)</option>
    <option value="100">100 (gratis)</option>
    <option value="200">200 (gratis)</option>
    <option value="custom">Custom</option>
  </select>
  <input id="customCount" type="number" min="1" max="999" class="hidden">

  <label>Nomor yang mau di-report</label>
  <input id="targetNumber" type="text" placeholder="Nomor target">

  <button id="btnStart" onclick="startReport()">Mulai Report</button>
  <button id="btnStop" onclick="stopReport()" class="hidden" style="background:var(--danger)">STOP</button>

  <div id="progress"></div>
  <p id="statusText"></p>
</div>

<!-- WhatsApp Web JS + QR generator -->
<script src="https://cdn.jsdelivr.net/npm/whatsapp-web.js@1.23.0/dist/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script>
/* ---------- CONFIG ---------- */
const PASSWORD = "admin"; // ganti kalau mau
const DELAY = 3000; // 3 detik
/* ---------- LOGIN ---------- */
function login(){
  if(document.getElementById('pwd').value === PASSWORD){
    document.getElementById('loginPage').classList.add('hidden');
    document.getElementById('reportPage').classList.remove('hidden');
  }else{
    alert("Password salah");
  }
}
/* ---------- WA CLIENT ---------- */
let client, ready=false, abort=false;

function getPairingCode(){
  const phone = document.getElementById('myPhone').value.trim();
  if(!phone){ alert("Isi nomor WA kamu"); return; }

  if(client) client.destroy();
  client = new WhatsAppWeb.Client({
    authStrategy: new WhatsAppWeb.LocalAuth({dataPath:"/tmp"}),
    puppeteer:{headless:true,args:['--no-sandbox','--disable-setuid-sandbox']}
  });
  client.on('qr', qr=>{
    // gunakan kode pairing (nomor diisi)
    client.requestPairingCode(phone).then(code=>{
      document.getElementById('pairInfo').classList.remove('hidden');
      document.getElementById('pairCode').innerText = code;
    });
  });
  client.on('ready', ()=>{ ready=true; alert("WhatsApp siap!"); });
  client.initialize();
}
/* ---------- REPORT ---------- */
function stopReport(){ abort=true; }
function startReport(){
  if(!ready){ alert("WhatsApp belum siap / belum pairing"); return; }

  const target = document.getElementById('targetNumber').value.trim();
  if(!target){ alert("Isi nomor target"); return; }

  let total;
  const sel = document.getElementById('countSelect').value;
  if(sel === "custom"){
    total = parseInt(document.getElementById('customCount').value) || 0;
  }else{
    total = parseInt(sel);
  }
  if(total<1 || total>999){ alert("Jumlah tidak valid"); return; }

  document.getElementById('progress').innerHTML='';
  document.getElementById('statusText').innerText='';
  document.getElementById('btnStart').disabled=true;
  document.getElementById('btnStop').classList.remove('hidden');

  // bikin dot kosong
  for(let i=0;i<total;i++){
    const d=document.createElement('div');
    d.className='dot';
    d.id='dot'+i;
    document.getElementById('progress').appendChild(d);
  }

  let sent=0, failed=0;
  abort=false;
  (async ()=>{
    for(let i=0;i<total;i++){
      if(abort){ break; }
      try{
        await client.sendMessage(`${document.getElementById('myPhone').value}@c.us`,
          `Report #${i+1} untuk nomor ${target}`);
        document.getElementById('dot'+i).classList.add('ok');
        sent++;
      }catch(e){
        document.getElementById('dot'+i).classList.add('err');
        failed++;
      }
      document.getElementById('statusText').innerText=`Berhasil: ${sent}  |  Gagal: ${failed}`;
      await new Promise(r=>setTimeout(r,DELAY));
    }
    document.getElementById('btnStart').disabled=false;
    document.getElementById('btnStop').classList.add('hidden');
    alert(abort ? "Report dihentikan" : "Report selesai");
  })();
}

/* tampilkan custom count */
document.getElementById('countSelect').addEventListener('change',e=>{
  document.getElementById('customCount').classList.toggle('hidden', e.target.value!=='custom');
});
</script>
</body>
</html>
